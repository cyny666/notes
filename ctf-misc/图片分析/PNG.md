### 文件格式

对于一个PNG文件来说，其文件头总是由固定的字节来描述的，剩余的部分由3个以上的PNG的数据块(Chunk)按照特定的顺序组成。

文件头89 50 4E 47 0D 0A 1A 0A+数据块+数据块+数据块......

### 数据块CHUNk

PNG定义了两种类型的数据块，一种是称为关键数据块(critical chunk),这是标准的数据快，另一种叫做辅助数据块(ancillary chunks)，这是可选的数据块。关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们，PNG读写软件也必须要支持这些数据块

| 数据块符号 | 数据块名称             | 多数据块 | 可选否 | 位置限制         |
| ---------- | ---------------------- | -------- | ------ | ---------------- |
| IHDR       | 文件头数据块           | 否       | 否     | 第一块           |
| cHRM       | 基色和白色点数据块     | 否       | 是     | 在PLTE和IDAT之前 |
| gAMA       | 图像数据块             | 否       | 是     | 在PLTE和IDAT之前 |
| sBIT       | 样本有效位数据块       | 否       | 是     | 在PLTE和IDAT之前 |
| PLTE       | 调色板数据块           | 否       | 是     | 在IDAT之前       |
| bKGD       | 背景颜色数据块         | 否       | 是     | 在PLTE后IDAT前   |
| hIST       | 图像直方图数据块       | 否       | 是     | 在PLTE后IDAT前   |
| tRNS       | 图像透明数据块         | 否       | 是     | 在PLTE后IDAT前   |
| oFFs       | 专用公共数据块         | 否       | 是     | 在IDAT之前       |
| pHYs       | 物理像素尺寸数据块     | 否       | 是     | 在IDAT之前       |
| sCAL       | 专用公共数据块         | 否       | 是     | 在IDAT之前       |
| IDAT       | 图像数据块             | 是       | 否     | 与其他IDAT连续   |
| tIME       | 图像最后修改时间数据块 | 否       | 是     | 无限制           |
| tEXt       | 文本信息数据块         | 是       | 是     | 无限制           |
| zTXt       | 压缩文本数据块         | 是       | 是     | 无限制           |
| fRAc       | 专用公共数据块         | 是       | 是     | 无限制           |
| gIFg       | 专用公共数据块         | 是       | 是     | 无限制           |
| gIFt       | 专用公共数据块         | 是       | 是     | 无限制           |
| gIFx       | 专用公共数据块         | 是       | 是     | 无限制           |
| IEND       | 图像结束数据           | 否       | 否     | 最后一个数据块   |

每个数据块由4个部分组成

| 名称                            | 字节数   | 说明                                               |
| ------------------------------- | -------- | -------------------------------------------------- |
| Length（长度）                  | 4字节    | 指定数据块中数据域的长度，其长度不超过(2^31-1)字节 |
| Chunk Type Code（数据块类型码） | 4字节    | 数据块类型由ASCII字母（A-Z和a-z）组成              |
| Chunk Data（数据块数据）        | 可变长度 | 存储按照Chunk Type Code指定的数据                  |
| CRC（循环冗余检测）             | 4字节    | 存储用来检测是否有错误的循环冗余码                 |

### IHDR

文件头数据块IHDR(Header Chunk):它包含有PNg文件中存储的图像数据的基本信息，由13字节组成，并要作为第一个数据块出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块

我们关注的是前8字节的内容

| 域的名称 | 字节数  | 说明                   |
| -------- | ------- | ---------------------- |
| Width    | 4 bytes | 图像宽度，以像素为单位 |
| Height   | 4 bytes | 图像高度，以像素为单位 |

我们经常会去更改一张图片的高度或者宽度使得一张图片显示不完整从而达到隐藏信息的目的。

### PLTE

调色板数据块PLTE（palette chunk）：它包含有与索引彩色图像（indexed-color image）相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块（image data chunk）之前。真彩色的PNG数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像

### IDAT

图像数据块IDAT(image data chunk):它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。

* 储存图像像素数据
* 在数据流中可包含多个连续顺序的图像数据块
* 采用LZ77算法的派生算法进行压缩
* 可以用zlib解压缩

值得注意的是，IDAT块只有当上一个块充满时，才会继续一个新的块

### IEND

图像结束数据IEND(image trailer chunk):它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部

### 其余辅助数据块

* 背景颜色数据块bKGD（background color）
* 基色和白色度数据块cHRM（primary chromaticities），所谓的白色度是指当R=G=B最大值时在显示器上产生的白色度
* 图像\gamma数据块gAMA（image gamma）
* 图像直方图数据块hIST(image histogram)
* 物理像素尺寸数据块pHYs(physical pixel dimensions)
* 样本有效位数据块sBIT(significant bits)
* 文件信息数据块tEXt(textual data)
* 图像最后修改时间数据块tIME(image last-modification time)
* 图像透明数据块tRNS(transparency)
* 压缩文本数据块zTXt(compressed textual data)

### LSB

LSB全称Least Significant Bit，最低有效为。PNG文件中的图像像数一般是由RGB三原色（红绿蓝）组成，每一种颜色占用8位，取值范围为0x00至0xFF，即为256种颜色，一共包含了256的3次方颜色。

而人类的眼睛可以区分约1000万种不同的颜色，意味着人类的眼睛无法区分余下的颜色大约有6777216种。

LSB隐写就是修改RGB颜色分量的最低二进制位（LSB），每个颜色会有8bit，LSB隐写就是修改了像数中的最低的1bit，而人类的眼睛不会注意到这前后的变化，每个像素可以携带3bit的信息